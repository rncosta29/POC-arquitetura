%%-----------------------------------------------------------
%% Diagrama de Componentes ‚Äî Charging Service (POC Solu√ß√µes EV-Costa)
%% Compat√≠vel com GitHub
%%-----------------------------------------------------------

flowchart TD
    %% --- Contexto principal ---
    subgraph ChargingService["‚ö° Charging Service ‚Äî Spring Boot (Java 21)"]
        
        subgraph ControllerLayer["üéØ Controller Layer"]
            A["ChargingController\nExp√µe endpoints HTTP para cria√ß√£o, consulta e encerramento de sess√µes de recarga"]
        end

        subgraph ServiceLayer["üß† Application / Domain Layer"]
            B["ChargingSessionService\nGerencia o ciclo de vida da sess√£o de recarga e aplica regras de neg√≥cio"]
        end

        subgraph DataLayer["üíæ Persistence Layer"]
            C["ChargingSessionRepository\nJPA Repository respons√°vel pela persist√™ncia no PostgreSQL"]
        end

        subgraph IntegrationLayer["üåç Integration Layer"]
            D["ChargingEventProducer\nPublica eventos de recarga no Kafka"]
            E["ChargingEventConsumer\nRecebe eventos externos e atualiza estado de sess√£o"]
            F["ChargingCacheManager\nGerencia dados tempor√°rios e cache no Redis"]
            G["TelemetryAdapter\nExporta m√©tricas, logs e traces para observabilidade"]
            H["AuthClient\nValida tokens e permiss√µes no Auth Service via HTTP"]
            I["PaymentClient\nComunica-se com Payment Service para simula√ß√£o de pagamento"]
        end

    end

    %% --- Rela√ß√µes entre componentes ---
    A -->|Invoca regras de neg√≥cio| B
    B -->|Persiste dados de sess√£o| C
    B -.->|Publica eventos de status| D
    E -.->|Atualiza estado com base em eventos externos| B
    B -->|Armazena sess√µes tempor√°rias| F
    B -->|Envia m√©tricas e logs| G
    B -->|Valida credenciais de sess√£o OIDC| H
    B -->|Confirma transa√ß√£o de pagamento simulada| I
